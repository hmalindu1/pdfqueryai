version: 1
frontend:
  phases:
    preBuild:
      commands:
        - npm ci --cache .npm --prefer-offline
    build:
      commands:
        - echo "DATABASE_URL=$DATABASE_URL" >> .env
        - echo "KINDE_CLIENT_ID=$KINDE_CLIENT_ID" >> .env
        - echo "KINDE_CLIENT_SECRET=$KINDE_CLIENT_SECRET" >> .env
        - echo "KINDE_ISSUER_URL=$KINDE_ISSUER_URL" >> .env
        - echo "KINDE_SITE_URL=$KINDE_SITE_URL" >> .env
        - echo "KINDE_POST_LOGOUT_REDIRECT_URL=$KINDE_POST_LOGOUT_REDIRECT_URL" >> .env
        - echo "KINDE_POST_LOGIN_REDIRECT_URL=$KINDE_POST_LOGIN_REDIRECT_URL" >> .env
        - echo "UPLOADTHING_SECRET=$UPLOADTHING_SECRET" >> .env
        - echo "UPLOADTHING_APP_ID=$UPLOADTHING_APP_ID" >> .env
        - echo "OPENAI_API_KEY=$OPENAI_API_KEY" >> .env
        - echo "PINECONE_API_KEY=$PINECONE_API_KEY" >> .env
        - echo "PADDLE_API_KEY=$PADDLE_API_KEY" >> .env
        - echo "NEXT_PUBLIC_PADDLE_CLIENT_TOKEN=$NEXT_PUBLIC_PADDLE_CLIENT_TOKEN" >> .env
        - echo "NEXT_PUBLIC_PADDLE_PRICE_ID=$NEXT_PUBLIC_PADDLE_PRICE_ID" >> .env
        - echo "NEXT_PUBLIC_API_URL=$NEXT_PUBLIC_API_URL" >> .env
        - echo "PADDLE_WEBHOOK_KEY=$PADDLE_WEBHOOK_KEY" >> .env
        - npm run build
  artifacts:
    baseDirectory: .next
    files:
      - '**/*'
  cache:
    paths:
      - .next/cache/**/*
      - .npm/**/*
